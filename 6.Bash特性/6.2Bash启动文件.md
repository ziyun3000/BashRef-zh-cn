## 6.2 Bash启动文件（Bash Startup Files）

该部分描述的是Bash如何执行其启动文件。如果有任意的启动文件存在但不可读，则Bash会报错。关于在文件名中的波浪号扩展的描述可参考3.5.2《波浪号扩展》部分。

交互式shell可参考6.3《交互式shell》部分。

### Bash作为交互式登录shell调用，或调用时带有“--login”选项

当Bash作为一个交互式登录shell调用时，或作为带有“--login”选项的非交互式shell调用时，如果文件“/etc/profile”存在，其会首先读取该文件并执行其中的命令。在读取了这个文件后，其会按顺序查找“~/.bash_profile”、“~/.bash_login”和“~/.profile”文件，并且会从找到的第一个存在的、可读的文件中读取命令并且执行。当在shell启动时想要禁用该行为，则可以在调用Bash时使用“--noprofile”选项。

当一个交互式登录shell退出时，或一个非交互式登录shell执行到内建命令exit时，如果“~/.bash_logout”文件存在，Bash会读取中的命令并执行。

### Bash作为交互式非登录shell调用

当启动了一个非登录的交互式shell时，如果“~/.bashrc”文件存在的话，Bash将读取该文件并执行。可以使用“--norc”选项禁止这种行为。“--rcfile *file*”选项可以强制Bash从指定的文件中读取命令并执行，用于代替从默认的文件“~/.bashrc”中读取。

所以，一般情况下，你的“~/.bash_profile”文件应该在任何特定登录初始化之后（或之前）包含这一行：

```bash
if [ -f ~/.bashrc ]; then . ~/.bashrc; fi
```

### Bash作为非交互式调用

当Bash以非交互式启动来运行shell脚本，其在环境中查找BASH_ENV变量。如果找到，则对其值进行扩展。并且对其扩展出的文件名进行读取和执行。Bash的行为就像执行了下面的这个命令：

```bash
if [ -n "$BASH_ENV" ]; then . "$BASH_ENV"; fi
```

但变量PATH的值不会用于对该文件名的搜索。

就像上面提到的，如果在调用一个非交互式shell时使用了“--logoin”选项，Bash则会试图从登录sehll的启动文件中读取命令并执行。

### 使用sh调用Bash

如果使用sh这个名称调用Bash时，其会试图尽可能模仿早期版本的sh的启动行为，并与POSIX标准保持一致。

当其作为一个交互式登录shell调用，或作为一个带有“--logoin”选项的非交互式shell调用时，其首先会试图按顺序从“/etc/profile”和“~/.profile”中读取和执行命令。可以使用“--noprofile”选项禁用该行为。当使用sh调用一个交互式shell时，Bash会查找ENV变量。如果定义了该变量，则会扩展其值，并且会对扩展出的文件名进行读取和执行。一旦以sh调用shell，其不会从其它启动文件中读取执行命令，所以“--rcfile”是不会起作用的。使用sh调用一个非交互式shell时，不会试图读取任何其它启动文件。

当作为sh调用时，Bash会在读取启动文件文件后进行POSIX模式。

### 调用Bash进入POSIX模式

当Bash使用“--posix”命令行选项启动进入POSIX模式时，其会使用POSIX标准的启动文件。在这种模式下，交互式shell会将ENV变量进行扩展，并从所得到的文件读取并执行命令。不会对其它启动文件进行读取。

### 使用远程shell守护进程调用Bash

当由远程shell守护进程，通常为rshd，或安全shell守护进程sshd调用Bash时，其会试图确定其标准输入会连接到哪个网络连接。如果Bash确定了其运行于这种方式，如果文件“~/.bashrc”存在并可读的话，则从该文件读取并执行命令。但如果是使用sh调用的Bash，则不会这样做。“--norc”选项可用于禁用些行为，“--rcfile”选项可用于强制读取其它文件。但rshd和sshd通常不会在调用shell时使用这些选项或指定它们。

### 调用Bash时有效用户（或组）与真实用户（或组）ID不相等

如果Bash在启动时有效用户（或组）ID与真实用户（或组）ID不相等，并且没有给出“-p”选项时，则不会读取任何启动文件；不会从环境中继承shell函数；如果变量“SHELLOPTS”、“BASHOPTS”、“CDPATH”和“GLOBIGNORE”存在环境中，则忽略它们；并且将有效用户ID设置为真实用户ID。如果在调用时提供了“-p”选项，则具有以上相同的启动行为，但不会对有效用户ID进行重置。